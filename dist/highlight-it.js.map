{
  "version": 3,
  "sources": ["../utils.ts", "../engines/prism.ts", "../highlight-it.ts"],
  "sourcesContent": ["/**\n * Dynamically adds a script or stylesheet element to the document.\n */\nexport function addElement(resource: { tagName: \"script\" | \"link\"; src: string }): Promise<void> {\n\tconst { tagName, src } = resource;\n\n\treturn new Promise((resolve, reject) => {\n\t\tif (tagName === \"link\") {\n\t\t\tconst element = document.createElement(\"link\");\n\t\t\telement.onload = () => { resolve(); }\n\t\t\telement.onerror = () => {\n\t\t\t\treject(new Error(`Failed to load ${tagName}: ${src}`));\n\t\t\t}\n\t\t\telement.rel = \"stylesheet\";\n\t\t\telement.href = src;\n\t\t\tdebugger\n\t\t\tdocument.head.appendChild(element);\n\t\t} else {\n\t\t\tconst element = document.createElement(\"script\");\n\t\t\telement.onload = () => { resolve(); }\n\t\t\telement.onerror = () => {\n\t\t\t\treject(new Error(`Failed to load ${tagName}: ${src}`));\n\t\t\t}\n\t\t\telement.defer = true;\n\t\t\telement.src = src;\n\t\t\tdocument.body.appendChild(element);\n\t\t}\n\t});\n}\n\n/**\n * Waits for a condition to be met within a timeout period.\n */\nexport function waitForCondition(condition: () => boolean, timeout = 15000): Promise<void> {\n\treturn new Promise((resolve, reject) => {\n\t\tif (condition()) {\n\t\t\tresolve();\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst startTime = Date.now();\n\t\t\tconst interval = setInterval(() => {\n\t\t\t\tif (condition()) {\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\tresolve();\n\t\t\t\t} else if (Date.now() - startTime > timeout) {\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\treject(\n\t\t\t\t\t\tnew Error(\n\t\t\t\t\t\t\t\"Highlighting engine failed to load within expected time.\"\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}, 50);\n\t\t} catch (error) {\n\t\t\treject(error);\n\t\t}\n\t});\n}", "import type { HighlightEngine, Resource } from \"../type\";\nimport { addElement, waitForCondition } from \"../utils\";\n\nconst BASE_URL = \"https://cdn.jsdelivr.net/gh/PrismJS/prism@1.30.0\";\n\nconst PACKS = {\n    minimal: {\n        theme: { light: \"prism\", dark: \"prism\" },\n        plugins: [],\n    },\n    complete: {\n        theme: { light: \"prism-solarizedlight\", dark: \"prism-twilight\" },\n        plugins: [\n            \"autoloader\",\n            [\"line-numbers\", \"/plugins/line-numbers/prism-line-numbers.min.css\"],\n            [\"line-highlight\", \"/plugins/line-highlight/prism-line-highlight.min.css\"],\n        ],\n    },\n};\n\n/**\n * Prism.js Engine\n * Syntax highlighting engine powered by Prism.js\n */\nconst engine: HighlightEngine = {\n    async initialize(config) {\n        const { pack = \"minimal\", darkMode = false } = config;\n\n        // Stop Prism from auto-highlighting\n        if (!window.Prism) {\n            window.Prism = { manual: true, };\n        } else {\n            window.Prism.manual = true;\n        }\n\n        const resources: Resource[] = [];\n        const packConfig = PACKS[pack];\n\n        // Add theme CSS\n        const selectedTheme = darkMode ? packConfig.theme.dark : packConfig.theme.light;\n        resources.push({\n            tagName: \"link\",\n            src: `${BASE_URL}/themes/${selectedTheme}.min.css`,\n        });\n\n        // Add plugin CSS\n        const plugins = packConfig.plugins;\n        plugins.forEach((plugin) => {\n            const [pluginName, ...dependencies] = Array.isArray(plugin) ? plugin : [plugin];\n            dependencies.forEach((src) => {\n                resources.push({ tagName: \"link\", src });\n            })\n            resources.push({ tagName: \"script\", src: `${BASE_URL}/plugins/${pluginName}/prism-${pluginName}.min.js`, });\n        });\n\n        // Add core script\n        resources.push({ tagName: \"script\", src: `${BASE_URL}/components/prism-core.min.js` });\n        // Add line-numbers class if that plugin is requested\n        if (pack === \"complete\") {\n            document.body.classList.add(\"line-numbers\");\n        }\n\n        // Load all resources\n        const loadingResources = [\n            ...resources.map(addElement),\n            waitForCondition(() => !!window.Prism?.filename),\n            waitForCondition(() => !!window.Prism?.plugins?.autoloader)\n        ];\n        await Promise.all(loadingResources);\n    },\n\n    async highlight() {\n        window.Prism?.highlightAll?.();\n    },\n};\n\nexport default engine;", "/**\n * highlight-it - Main entry point\n * Parses script URL parameters and initializes the highlighting engine\n */\n\nimport type { CustomConfig } from \"./type\";\nimport prismEngine from \"./engines/prism\";\n\n(async function () {\n  // Only run in browser environment\n  if (typeof document === \"undefined\") {\n    return;\n  }\n\n  // Guard against multiple executions\n  if (window.__highlightItInitialized) {\n    return;\n  }\n  window.__highlightItInitialized = true;\n\n  /**\n   * Parses configuration from the script's URL parameters\n   * Extracts 'pack' and 'darkmode' parameters\n   */\n  function parseScriptParams(): CustomConfig {\n    const scriptElement = document.currentScript;\n\n    // Default configuration\n    const config: CustomConfig = {\n      pack: \"minimal\",\n      darkMode: false,\n    };\n\n    // Parse URL parameters if script element is available\n    if (scriptElement && scriptElement instanceof HTMLScriptElement && scriptElement.src) {\n      try {\n        const url = new URL(scriptElement.src);\n\n        // Get pack parameter (config or pack)\n        const packParam = url.searchParams.get(\"pack\") || url.searchParams.get(\"config\");\n        if (packParam && (packParam === \"minimal\" || packParam === \"complete\")) {\n          config.pack = packParam;\n        }\n\n        // Get darkmode parameter\n        const darkModeParam = url.searchParams.get(\"darkmode\") || url.searchParams.get(\"darkMode\");\n        if (darkModeParam) {\n          // Accept: true, 1, yes, on\n          config.darkMode = [\"true\", \"1\", \"yes\", \"on\"].includes(darkModeParam.toLowerCase());\n        } else {\n          // Auto-detect dark mode from system preference\n          config.darkMode = window.matchMedia &&\n            window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\n        }\n      } catch (error) {\n        console.warn(\"Failed to parse script URL:\", error);\n      }\n    } else {\n      // Auto-detect dark mode if no script element\n      config.darkMode = window.matchMedia &&\n        window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\n    }\n\n    return config;\n  }\n\n  // ==================== Main Execution ====================\n  try {\n    // Parse configuration from script URL\n    const config = parseScriptParams();\n\n    console.log(\"highlight-it initialized with config:\", config);\n\n    // Load the engine (currently only Prism.js is supported)\n    const engine = prismEngine;\n\n    // Initialize the engine with parsed configuration\n    await engine.initialize(config);\n\n    // Trigger syntax highlighting\n    await engine.highlight();\n\n    console.log(\"highlight-it: Code highlighting completed\");\n  } catch (error) {\n    console.error(\"highlight-it error:\", error);\n  }\n})();\n"],
  "mappings": "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",
  "names": ["addElement", "resource", "tagName", "src", "resolve", "reject", "element", "waitForCondition", "condition", "timeout", "startTime", "interval", "error", "init_utils", "__esmMin", "BASE_URL", "PACKS", "engine", "prism_default", "init_prism", "__esmMin", "init_utils", "config", "pack", "darkMode", "resources", "packConfig", "selectedTheme", "plugin", "pluginName", "dependencies", "src", "loadingResources", "addElement", "waitForCondition", "_a", "_b", "require_highlight_it", "__commonJSMin", "init_prism", "parseScriptParams", "scriptElement", "config", "url", "packParam", "darkModeParam", "error", "engine", "prism_default"]
}
